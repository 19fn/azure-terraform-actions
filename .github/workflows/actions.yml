on: [push]

name: WebAppDevTest

env:
  # set this to your application's name
  AZURE_WEBAPP_NAME: voting-app-flask
  # set this to the path to your web app project, defaults to the repository root
  AZURE_WEBAPP_PACKAGE_PATH: 'votingapp'

jobs:
  webapp:
    name: 'WebApp'
    runs-on: ubuntu-latest

    # Set the bash shell
    defaults:
      run:
        shell: bash

    steps:
      # Checkout the repository to the GitHub Actions runner
      - name: Checkout
        uses: actions/checkout@v2

      - name: Log in with Service Principal Azure
        uses: azure/login@v1
        with:
          creds: '${{ secrets.AZURE_CREDENTIALS }}'
      
      - name: Setup Python 3.x 
        uses: actions/setup-python@v1
        with:
          python-version: 3.x

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
        working-directory: votingapp
    
      - name: Deploy web App 
        uses: azure/webapps-deploy@v2
        with:
          app-name: ${{ env.AZURE_WEBAPP_NAME }}
          package: ${{ env.AZURE_WEBAPP_PACKAGE_PATH }}
      
      - name: logout
        run: |
          az logout
